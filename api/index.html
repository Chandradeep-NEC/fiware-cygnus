<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>apiary</title>
</head>
<body>
  <script src="https://api.apiary.io/seeds/embed.js"></script>
  <script>
    var embed = new Apiary.Embed({
      apiBlueprint: "FORMAT: 1A\nHOST: http://cygnus.lab.fiware.org/\n\n# FIWARE-Cygnus API (v1)\n\nFIWARE-CYGNUS API (v1).\n\nThis is a cookbook with commands that show how to use FIWARE cygnus API.\nIt\'s a work in progress and is changing on a daily basis.\n\nPlease check the following [FIWARE Open Specification Legal Notice (implicit patents license)]\n(http://forge.fiware.org/plugins/mediawiki/wiki/fiware/index.php/FI-WARE_Open_Specification_Legal_Notice_(implicit_patents_license))\nto understand the rights to use this document.\n\n\n# Description\n\nThis resource allows you to obtain a list of subresources published by the API:\n\n* version of the current running cygnus on your system\n* statistics about the configured Flume components\n* useful information about configured grouping rules like:\n  * current grouping rules configured\n  * add, update or delete current grouping rules\n\n## Error responses\n\nError list (HTTP response code in parenthesis):\n\n* BadFields             (`400`). The incoming JSON payload cannot be parsed.\n* WrongFields           (`400`). The incoming request has invalid fields.\n* WrongSubscription     (`400`). Orion cant do the subscription.\n* BadRequest            (`400`). The request is invalid.\n* InternalServerError   (`500`). Internal error in the server.\n\n## Group Version API\n\n## Gets the version of the running Cygnus [GET /v1/version]\n\n+ Request\n\n       GET http://<cygnus_host>:<management_port>/v1/version\n\n+ Response 200 (application/json)\n\n       [\n            {\n              \"success\": \"true\",\n              \"version\": \"0.13.0_SNAPSHOT.52399574ea8503aa8038ad14850380d77529b550\"\n            }\n       ]\n\n## Group Statistics API\n\n## Get stats of Flume components [GET /v1/stats]\n\n+ Request\n\n       GET http://<cygnus_host>:<management_port>/v1/stats\n\n+ Response 200 (application/json)\n\n       [\n          {\n              \"stats\": {\n              \"channels\": [\n                    {\n                        \"name\": \"mysql-channel\",\n                        \"num_events\": 0,\n                        \"num_puts_failed\": 0,\n                        \"num_puts_ok\": 11858,\n                        \"num_takes_failed\": 1,\n                        \"num_takes_ok\": 11858,\n                        \"setup_time\": \"2016-02-05T10:34:25.80Z\",\n                        \"status\": \"START\"\n                    }\n                  ],\n              \"sinks\": [\n                    {\n                        \"name\": \"mysql-sink\",\n                        \"num_persisted_events\": 11800,\n                        \"num_processed_events\": 11858,\n                        \"setup_time\": \"2016-02-05T10:34:24.978Z\",\n                        \"status\": \"START\"\n                    }\n                  ],\n              \"sources\": [\n                    {\n                        \"name\": \"http-source\",\n                        \"num_processed_events\": 11858,\n                        \"num_received_events\": 11858,\n                        \"setup_time\": \"2016-02-05T10:34:24.921Z\",\n                        \"status\": \"START\"\n                    }\n                  ]\n              },\n              \"success\": \"true\"\n          }\n        ]\n\n## Resets the statistics about the configured Flume components [PUT /v1/stats]\n\n+ Request\n\n       PUT http://<cygnus_host>:<management_port>/v1/stats\n\n+ Response 200 (application/json)\n\n        {\n            \"success\":\"true\"\n        }\n\n## Group Grouping Rules API\n\n### Get current grouping rules [GET /v1/groupingrules]\n\n+ Request\n\n       GET http://<cygnus_host>:<management_port>/v1/groupingrules\n\n+ Response 200 (application/json)\n\n        [\n            {\n                \"grouping_rules\": [\n                        {\n                            \"destination\": \"allcars\",\n                            \"fields\": [\n                                  \"entityType\"\n                                  ],\n                            \"fiware_service_path\": \"cars\",\n                            \"id\": 1,\n                            \"regex\": \"Car\"\n                        },\n                        {\n                             \"destination\": \"allrooms\",\n                             \"fields\": [\n                                  \"entityType\"\n                                  ],\n                            \"fiware_service_path\": \"rooms\",\n                            \"id\": 2,\n                            \"regex\": \"Room\"\n                        }\n                    ],\n                \"success\": \"true\"\n            }\n        ]\n\n### Adds a new rule [POST /v1/groupingrules]\n\n+ Parameters\n\n       + id: 1 (number) - An unique identifier of the message.\n\n+ Request\n\n       POST http://<cygnus_host>:<management_port>/v1/groupingrules\n       {\n           \"regex\": \"Room\",\n           \"destination\": \"allrooms\",\n           \"fiware_service_path\": \"rooms\",\n           \"fields\": [\"entityType\"]\n       }\n\n+ Response 200 (application/json)\n\n       {\n           \"success\":\"true\"\n       }\n\n### Update an already existent grouping rules [PUT /v1/groupingrules]\n\n+ Parameters\n\n       + id: 1 (number) - An unique identifier of the message.\n\n+ Request\n\n       PUT http://<cygnus_host>:<management_port>/v1/groupingrules=id=1\n       {\n           \"regex\": \"Room\",\n           \"destination\": \"otherrooms\",\n           \"fiware_service_path\": \"rooms\",\n           \"fields\": [\"entityType\"]\n      }\n\n+ Response 200 (application/json)\n\n        [\n            {\"success\":\"true\"}\n        ]\n\n\n### Delete a grouping rules [DELETE /v1/groupingrules]\n\n+ Parameters\n\n       + id: 1 (number) - An unique identifier of the message.\n\n+ Request\n\n       DELETE http://<cygnus_host>:<management_port>/v1/groupingrules?id=2\n\n+ Response 200 (application/json)\n\n       [\n           {\"success\":\"true\"}\n       ]\n\n\n## Group Subscriptions API\n\n### Creates a new subscription to Orion (ngsi_version = 1) [POST /v1/subscriptions]\n\n+ Parameters\n\n       + ngsi_version: 1 (Defines the Orion API\'s version)\n\n+ Request\n\n       POST \"http://<cygnus_host>:<management_port>/v1/subscriptions?ngsi_version=1\"\n       {\n           \"subscription\":{\n           \"entities\": [\n                   {\n                       \"type\": \"Room\",\n                       \"isPattern\": \"false\",\n                       \"id\": \"Room1\"\n                   }\n               ],\n           \"attributes\": [],\n           \"reference\": \"http://<reference_host>:<reference_port>\",\n           \"duration\": \"P1M\",\n           \"notifyConditions\": [\n                   {\n                       \"type\": \"ONCHANGE\",\n                      \"condValues\": []\n                   }\n               ],\n           \"throttling\": \"PT5S\"\n           },\n           \"endpoint\":{\n                   \"host\":\"<endpoint_host>\",\n                   \"port\":\"<endpoint_port>\",\n                   \"ssl\":\"false\",\n                   \"xauthtoken\":\"234123123123123\"\n           }\n       }\n\n+ Response 200 (application/json)\n\n        {\n            \"success\":\"true\",\n            \"result\" : {\n                    {\n                      \"subscribeResponse\":{\n                                  \"duration\":\"P1M\",\n                                  \"throttling\":\"PT5S\",\n                                  \"subscriptionId\":\"56f9081c3c6fb7e9d2a912a0\"\n                        }\n                    }\n              }\n        }\n\n+ Response 400 (application/json)\n\n        {\n            \"success\":\"true\",\n            \"result\" : {\n                    \"subscribeError\": {\n                                \"errorCode\": {\n                                        \"code\":\"400\",\n                                        \"reasonPhrase\":\"Bad Request\",\n                                        \"details\":\"JSON Parse Error: unknown field: \\/extraField\"\n                                }\n                    }\n            }\n        }\n\n+ Response 400 (application/json)\n\n        {\n            \"success\":\"false\",\n            \"error\":\"Invalid subscription, field \'duration\' is empty\"\n        }\n\n+ Response 400 (application/json)\n\n        {\n            \"success\":\"false\",\n            \"error\":\"Invalid subscription, field \'notifyConditions\' is missing\"\n        }\n\n### Creates a new subscription to Orion (ngsi_version = 2) [POST /v1/subscriptions]\n\n+ Parameters\n\n       + ngsi_version: 2 (Defines the Orion API\'s version)\n\n+ Request\n\n       POST \"http://<cygnus_host>:<management_port>/v1/subscriptions?ngsi_version=<ngsi_version>\"\n       {\n               \"subscription\":{\n                       \"description\": \"One subscription to rule them all\",\n                       \"subject\": {\n                               \"entities\": [\n                                       {\n                                               \"idPattern\": \".*\",\n                                               \"type\": \"Room\"\n                                       }\n                               ],\n                               \"condition\": {\n                                       \"attrs\": [\n                                              \"temperature\"\n                                       ],\n                                       \"expression\": {\n                                               \"q\": \"temperature>40\"\n                                       }\n                               }\n                       },\n                       \"notification\": {\n                              \"http\": {\n                                      \"url\": \"http://localhost:1234\"\n                               },\n                               \"attrs\": [\n                                       \"temperature\",\n                                       \"humidity\"\n                               ]\n                       },\n                       \"expires\": \"2016-05-05T14:00:00.00Z\",\"throttling\": 5\n               },\n               \"endpoint\":{\n                       \"host\":\"orion.lab.fiware.org\",\n                       \"port\":\"1026\",\n                       \"ssl\":\"false\",\n                       \"xauthtoken\":\"QsENv67AJj7blC2qJ0YvfSc5hMWYrs\"\n               }\n       }\n\n+ Response 201 (application/json)\n\n       {\n               \"success\":\"true\",\n               \"result\" : {\n                       \"SubscriptionID\" : \"572ae23d20e1387832ed98d0\"\n               }\n       }\n\n+ Response 400 (application/json)\n\n       {\n               \"success\":\"false\",\n               \"error\":\"Invalid subscription, field \'xxxxxx\' is missing\"\n       }\n\n+ Response 400 (application/json)\n\n       {\n               \"success\":\"false\",\n               \"error\":\"Invalid subscription, field \'xxxxxx\' has missing fields\"\n       }\n\n+ Response 400 (application/json)\n\n       {\n               \"success\":\"false\",\n               \"error\":\"Missing endpoint\"\n       }\n\n### Gets a current subscription [GET /v1/subscriptions]\n\n+ Parameters\n\n       + ngsi_version: 2 (Defines the Orion API\'s version)\n       + subscription_id: <subscriptionId> (Subscription\'s identificator)\n\n+ Request\n\n       GET http://<cygnus_host>:<management_port>/v1/subscriptions?ngsi_version=<ngsiVersion>&subscription_id=<subscriptionId>\n       {\n               \"host\":\"orion.lab.fi-ware.org\",\n               \"port\":\"1026\",\n               \"ssl\":\"false\",\n               \"xauthtoken\":\"QsENv67AJj7blC2rt54ESc5hMWYrs\"\n       }\n\n+ Response 200 (application/json)\n\n       {\n               \"success\":\"true\",\n               \"result\" : {\n                       {\n                               \"notification\":{\n                                       \"lastNotification\":\"2015-07-28T22:24:33.00Z\",\n                                       \"timesSent\":8122767998226748692,\n                                       \"callback\":\"http:\\/\\/xxx.xxx.xx.xxx:xxxx\\/ngsi10\\/notifyContext\",\n                                       \"attributes\":[\n                                       ]\n                               },\n                               \"expires\":\"2016-09-25T08:17:47.00Z\",\n                               \"subject\":{\n                                       \"condition\":{\n                                               \"expression\":{\n                                                       \"q\":\"\",\n                                                       \"geometry\":\"\",\n                                                       \"coords\":\"\",\n                                                       \"georel\":\"\"\n                                               },\n                                               \"attributes\":[\n                                                       \"TimeInstant\"\n                                               ]\n                                       },\n                                       \"entities\":[\n                                               {\n                                                       \"id\":\"\",\n                                                       \"type\":\"sevilla:fountain\",\n                                                       \"idPattern\":\"patternId\"\n                                               }\n                                       ]\n                               },\n                               \"id\":\"54325022q469a3873d30oe95\",\n                               \"status\":\"active\"\n                       }\n               }\n       }\n\n+ Response 400 (application/json)\n\n       {\n               \"success\":\"false\",\n               \"result\" : {\n                       {\n                               \"description\":\"\",\n                               \"error\":\"subscriptionId does not correspond to an active subscription\"\n                       }\n               }\n       }\n\n+ Response 400 (application/json)\n\n       {\n               \"success\":\"false\",\n               \"error\":\"Parse error, invalid parameter (ngsi_version): Must be 1 or 2. Check it for errors.\"\n       }\n\n+ Response 400 (application/json)\n\n       {\n               \"success\":\"false\",\n               \"error\":\"GET /v1/subscriptions not implemented.\"\n       }\n\n\n### Deletes a current subscription to Orion [DELETE /v1/subscriptions]\n\n+ Parameters\n\n       + ngsi_version: 1 or 2 (Defines the Orion API\'s version)\n       + subscription_id: <subscriptionId> (Subscription\'s identificator)\n\n+ Request\n\n       DELETE \"http://<cygnus_host>:<management_port>/v1/subscriptions?subscription_id=<subscriptionId>&ngsi_version=<ngsiVersion>\"\n\n+ Response 204 (application/json)\n\n       {\n               \"success\":\"true\",\n               \"result\" : {\n                       \" Subscription deleted \"\n               }\n       }\n\n+ Response 400 (application/json) [Bad parameters]\n\n       {\n               \"success\":\"false\",\n               \"error\":\"Parse error, wrong parameter (subscription_id). Check it for errors.\"\n       }\n\n+ Response 400 (application/json) [Wrong subscription id in v1]\n\n       {\n               \"success\":\"false\",\n               \"result\" : {\n                       {\n                             \"subscriptionId\":\"571872a9c0585c7451571be4\",\n                             \"statusCode\":{\n                                   \"code\":\"404\",\n                                   \"reasonPhrase\":\"No context element found\",\n                                   \"details\":\"subscriptionId: \\/571872a9c0585c7451571be4\\/\"\n                             }\n                       }\n               }\n       }\n\n+ Response 400 (application/json) [Wrong subscription id in v2]\n\n       {\n               \"success\":\"false\",\n               \"result\" : {\n                       {\n                             \"description\":\"The requested subscription has not been found. Check id\",\"error\":\"NotFound\"\n                       }\n               }\n       }\n\n+ Response 400 (application/json) [Empty authentication token]\n\n       {\n               \"success\":\"false\",\n               \"error\":\"Empty Auth-Token. Required for API methods\"\n       }\n\n+ Response 400 (application/json) [Missing authentication token]\n\n       {\n               \"success\":\"false\",\n               \"error\":\"Missing Auth-Token. Required for API methods\"\n       }\n\n\n## Group Admin API\n\n### Gets the log4j configuration [GET /admin/log]\n\n+ Request\n\n       GET http://<cygnus_host>:<management_port>/admin/log\n\n+ Response 200 (application/json)\n\n       {\n           \"log4j\": {\n           \"appenders\": [\n               {\n                   \"layout\": \"...\",\n                   \"name\": \"...\"\n               }\n            ],\n            \"level\": \"...\"\n           },\n           \"success\": \"true\"\n       }\n\n+ Response 500 (application/json)\n\n       {\n           \"error\": \"...\"\n       }\n\n### Update the logging level of Cygnus [PUT /admin/log]\n\n+ Parameters\n\n        + loglevel: Must be DEBUG, INFO, WARN, ERROR o FATAL (String) - A valid log level.\n\n+ Request\n\n       PUT http://<cygnus_host>:<management_port>/admin/log?level=<log_level>\n\n+ Response 200 (text/plain)\n\n       OK\n\n+ Response 400 (application/json)\n\n       {\n           \"error\":\"Invalid log level\"\n       }\n\n+ Response 400 (application/json)\n\n       {\n           \"error\":\"\"\n       }\n\n"
    });
  </script>
</body>
</html>
